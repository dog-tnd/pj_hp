---
import Layout from '../../layouts/Layout.astro';
import Menu from '../../components/menu';
import TwoLine from '../../components/TwoLine.astro';
import NewsCard from '../../components/NewsCard';

// ブログ記事の型定義
interface BlogPost {
  frontmatter: {
    title: string;
    description: string;
    author: string;
    role: string;
    authorImage: string;
    date: string;
    image: string;
    tags?: string[];
  };
  url: string;
  file: string;
  Content: any;
}

// ブログ記事の取得（型キャストを追加）
const posts = await Astro.glob('../../content/blog/*.md') as BlogPost[];
const sortedPosts = posts.sort((a, b) => {
  return new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime();
});

// すべてのタグを収集
const allTags = [...new Set(
  sortedPosts
    .filter(post => post.frontmatter.tags)
    .flatMap(post => post.frontmatter.tags || [])
)];

// 最新の記事を取得
const featuredPost = sortedPosts[0];
const recentPosts = sortedPosts.slice(1, 4);
const remainingPosts = sortedPosts.slice(4);

// 日付をフォーマット
function formatDate(dateString: string) {
  const date = new Date(dateString);
  if (isNaN(date.getTime())) {
    console.error(`Invalid date: ${dateString}`);
    return 'Invalid date';
  }
  return new Intl.DateTimeFormat('ja-JP', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
}
---
<Layout title="ブログ | プログラミングサークル TND">
  <header>
    <TwoLine />
  </header>

  <main class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
    <div class="container flex flex-col md:flex-row items-center gap-10 relative pt-20">
      <Menu client:load />
    </div>

    <!-- ヒーローセクション -->
    <!-- 省略 -->
    
    <!-- すべての記事 -->
    <section id="all-posts" class="py-16 animate-fade-in animation-delay-300">
      <div class="container mx-auto px-4">
        <h2 class="text-2xl font-bold mb-8 flex items-center">
          <span class="inline-block w-8 h-8 bg-blue-500 rounded-full mr-3 flex items-center justify-center text-white">
            <!-- SVGアイコン -->
          </span>
          すべての記事
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {sortedPosts.map((post, index) => {
            const slug = post.file.split('/').pop()?.replace('.md', '');
            const postUrl = `/blog/${slug}`;
            
            return (
              <div class="animate-fade-in" style={`animation-delay: ${0.4 + (index % 6) * 0.1}s`}>
                <NewsCard
                  image={post.frontmatter.image}
                  title={post.frontmatter.title}
                  description={post.frontmatter.description}
                  author={post.frontmatter.author}
                  role={post.frontmatter.role}
                  authorImage={post.frontmatter.authorImage}
                  date={post.frontmatter.date}
                  url={postUrl}
                  client:load
                />
              </div>
            );
          })}
        </div>
      </div>
    </section>
  </main>

  <footer class="mt-24 border-t border-gray-200 py-8">
    <div class="mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
      <p class="text-sm text-gray-500">© 2024 TND All Rights Reserved.</p>
    </div>
  </footer>

<style>
  /* アニメーション */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .animate-fade-in {
    animation: fadeIn 0.6s ease-out forwards;
    opacity: 0;
  }
  
  .animation-delay-100 {
    animation-delay: 0.1s;
  }
  
  .animation-delay-200 {
    animation-delay: 0.2s;
  }
  
  .animation-delay-300 {
    animation-delay: 0.3s;
  }
  
  .animation-delay-400 {
    animation-delay: 0.4s;
  }
  
  /* ホバーエフェクト */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* スムーズスクロール */
  html {
    scroll-behavior: smooth;
  }
</style>