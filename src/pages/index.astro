---
import Layout from '../layouts/Layout.astro';
import TwoLine from '../components/TwoLine.astro';
import Menu from '../components/menu';
import NewsCard from '../components/NewsCard';

// ブログ記事の型定義
interface BlogPost {
  frontmatter: {
    title: string;
    description: string;
    author: string;
    role: string;
    authorImage: string;
    date: string;
    image: string;
    tags?: string[];
  };
  url: string;
  file: string;
  Content: any;
}

// ブログ記事の取得（型キャストを追加）
const posts = await Astro.glob('../content/blog/*.md') as BlogPost[];
const sortedPosts = posts.sort((a, b) => {
  return new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime();
});

// すべてのタグを収集
const allTags = [...new Set(
  sortedPosts
    .filter(post => post.frontmatter.tags)
    .flatMap(post => post.frontmatter.tags || [])
)];

// 最新の記事を取得
const featuredPost = sortedPosts[0];
const recentPosts = sortedPosts.slice(1, 4);

// 日付をフォーマット
function formatDate(dateString: string) {
  const date = new Date(dateString);
  if (isNaN(date.getTime())) {
    console.error(`Invalid date: ${dateString}`);
    return 'Invalid date';
  }
  return new Intl.DateTimeFormat('ja-JP', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
}

// 最新の記事を取得（最大4件）
const latestPosts = sortedPosts.slice(0, 4);

---

<Layout title="理科大プログラミングサークル TND">

  <header>
    <TwoLine />
  </header>

  <main class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
    <!-- Hero Section -->

    <div class="container flex flex-col md:flex-row items-center gap-10 relative pt-20">
      <Menu client:load />
      <section class="mb-16">
        <h2 class="mb-8 text-gray-900 md:pt-[3rem]" style="color: #000; font-family: 'Rubik Doodle Shadow'; font-size: 38px; font-style: normal; font-weight: 400; line-height: normal;">What's TND</h2>
        <div class="prose prose-lg max-w-xg text-gray-600 md:max-w-md lg:max-w-xl">
          <p>
            TNDはweb開発をメインに活動する東京理科大学のプログラミングサークルです。2024年に設立され、現在は20名のメンバーが所属しています。
          </p>
          <p>
            フロントエンド、バックエンド、デザイン、データサイエンスなど様々な分野の技術を学び、実践しています。
          </p>
        </div>
      </section>
      <img src="/mainCharm.svg" alt="mainCharm" class="w-full md:w-auto md:absolute top-[5rem] right-[2rem] max-w-xs md:max-w-md lg:max-w-lg pb-[5rem] opacity-30" />
    </div>

    <div class="container flex flex-col md:flex-row items-center gap-10">
      <section class="mb-16">
        <h2 class="mb-8 text-gray-900" style="color: #000; font-family: 'Rubik Doodle Shadow'; font-size: 30px; font-style: normal; font-weight: 400; line-height: normal;">
          NEWS
        </h2>
        <div class="container flex flex-col md:flex-row gap-5">
          {sortedPosts.map((post, index) => {
            const slug = post.file.split('/').pop()?.replace('.md', '');
            const postUrl = `/blog/${slug}`;
            
            return (
              <div class="animate-fade-in" style={`animation-delay: ${0.4 + (index % 6) * 0.1}s`}>
                <NewsCard
                  image={post.frontmatter.image}
                  title={post.frontmatter.title}
                  description={post.frontmatter.description}
                  author={post.frontmatter.author}
                  role={post.frontmatter.role}
                  authorImage={post.frontmatter.authorImage}
                  date={post.frontmatter.date}
                  url={postUrl}
                  client:load
                />
              </div>
            );
          })}
        </div>
      </section>
    </div>
    
    <!-- SNS LOGOs -->
    <div class="container items-center md:items-start flex md:flex-col flex-row gap-5 md:absolute bottom-40 left-5">
      <p class="vertical rotate-180" style="font-family: 'Abel';">-Follow-</p>
      <a href="https://x.com/TokyorikaND" target="_blank" rel="noopener noreferrer">
        <img 
          src="/sns-x.png" 
          alt="XIcon" 
          class="w-[1rem] h-[1rem] sm:w-[1.5rem] sm:h-[1.5rem] md:w-[2rem] md:h-[2rem] hover:opacity-80 transition-opacity" 
        />
      </a>
      <a href="https://discord.gg/k3qMBEn3CC" target="_blank" rel="noopener noreferrer">
        <img 
          src="/sns-discord.svg" 
          alt="DiscordIcon" 
          class="w-[1rem] h-[1rem] sm:w-[1.5rem] sm:h-[1.5rem] md:w-[2rem] md:h-[2rem] hover:opacity-80 transition-opacity" 
        />
      </a>
    </div> 
  </main>
  
  <!-- Footer -->
  <footer class="mt-24 border-t border-gray-200 py-8">
    <div class="mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
      <p class="text-sm text-gray-500">© 2025 TND All Rights Reserved.</p>
    </div>
  </footer>
</Layout>